# AIMangaStudio 项目分析

## 项目概述
一个完整的前端 AI 漫画创作工具，专注于**交互式漫画编辑和分镜设计**。

## 技术栈
- **前端框架**：React 19 + Vite + TypeScript
- **AI 模型**：Google Gemini 2.5 Flash（文本 + 图像生成）
  - `gemini-2.5-flash`：文本生成、故事建议
  - `gemini-2.5-flash-image-preview`：图像生成、角色表、分镜
- **依赖极简**：只有 React + Google GenAI SDK，无其他重型库
- **部署**：可一键部署到 Vercel/Netlify

## 核心功能模块

### 1. 角色系统（Character System）
**特点**：先创建角色，再使用角色
- **角色生成**：
  - 用户上传参考图 → AI 生成标准角色表（6 姿势：3个头像 + 3个全身）
  - 支持黑白/彩色两种模式
  - 可以基于文字描述 + 参考风格生成新角色
- **角色一致性方案**：
  - 每个角色有独立的 `sheetImage`（AI生成的参考表）
  - 生成漫画时，将角色表图像传递给 Gemini
  - Gemini 根据角色表保持视觉一致性
- **角色编辑**：支持文字指令编辑角色表

### 2. 分镜系统（Panel Layout）
**特点**：可视化画布编辑器
- **画布工具**：
  - 拖拽式分镜布局（Panel shapes）
  - 添加对话气泡（Bubble shapes）
  - 文本标注（Text shapes）
  - 自由绘图（Drawing shapes）
  - 箭头标注（Arrow shapes）
  - 角色姿势占位（Image shapes with skeleton pose）
- **骨骼姿势编辑器**：
  - 可以在分镜里放置角色骨架
  - 定义角色的具体姿势（全身/上半身/下半身/面部）
  - AI 根据骨架生成对应姿势的角色
- **撤销/重做**：完整的历史记录系统

### 3. AI 剧情生成
- **世界观设定**（Worldview）：
  - 用户定义整个漫画的世界观背景
  - 后续所有剧情生成都基于此世界观
- **故事建议**（Story Suggestion）：
  - 输入前提 → AI 生成 2-4 个分镜的详细剧本
  - 包含每个分镜的动作、表情、对话
  - 支持续写前一页的剧情（带上下文）
- **自动批量生成**（Auto Generation）：
  - 一键生成多页漫画（3-10页）
  - 自动生成故事 → 自动生成分镜布局 → 用户可手动编辑
  - 支持中断和从失败页重试

### 4. 分镜布局建议
- **AI 辅助布局**：
  - 根据故事脚本，AI 生成灰度素描分镜布局
  - 使用专业漫画分镜技巧（动态角度、重叠分镜、变化尺寸）
  - 可作为"参考图层"叠加在画布上（可调透明度）
  - 用户可以直接应用或手动调整

### 5. 漫画页生成
**核心流程**：角色表 + 分镜布局 + 剧本 → 完整漫画页
- **输入资源**：
  - 角色参考表（多个角色）
  - 分镜布局图像（含骨架姿势标注）
  - 场景描述文本
  - 可选：前一页的图像（用于连续性）
- **生成模式**：
  - 黑白/彩色可选
  - 支持生成空白对话气泡（后期填文字）
- **页间连续性**：
  - 可以勾选"参考前一页"
  - 保持角色服装、场景、情绪一致

### 6. 后期编辑功能
- **上色**（Colorize）：
  - 黑白漫画一键上色
  - 根据角色原始参考图确定颜色
- **局部编辑**（Edit with Mask）：
  - 手绘遮罩选择编辑区域
  - 文字指令修改局部内容
  - 可以添加参考图像辅助编辑
- **质量分析**（Analysis）：
  - AI 对比分镜布局和生成结果
  - 检测差异（角色错误、姿势不对、重复角色等）
  - 自动生成修正提示词
  - 一键应用修正

### 7. 导出和预览
- **漫画阅读器**：
  - 全屏阅读模式
  - 翻页浏览所有页面
- **批量导出**：
  - 导出为 PNG/PDF
  - 支持多页漫画

### 8. 视频制作器（Video Producer）
- **从漫画生成视频**：
  - 分析每一页，生成视频场景
  - AI 推荐最适合的视频模型（Seedance/Hailuo/Veo/Kling）
  - 生成不同模型的专用提示词
- **视频编辑**：
  - 调整每个场景的时长
  - 设置转场效果、VFX、镜头运动

## 数据结构设计

### Character（角色）
```typescript
{
  id: string;
  name: string;
  referenceImages: string[];  // 原始上传图片
  sheetImage: string;          // AI生成的角色表
  description?: string;        // 角色描述
}
```

### Page（漫画页）
```typescript
{
  id: string;
  name: string;
  shapes: CanvasShape[];              // 画布元素（分镜、文字、气泡等）
  shapesHistory: CanvasShape[][];     // 历史记录（撤销/重做）
  panelLayoutImage: string | null;     // 分镜布局快照
  sceneDescription: string;            // 剧本文本
  generatedImage: string | null;       // 生成的漫画图像
  aspectRatio: string;                 // 比例（A4/竖版/正方形/横版）
  shouldReferencePrevious: boolean;    // 是否参考上一页
  assistantProposalImage: string | null; // AI建议的布局图
}
```

### Shape 类型
- **PanelShape**：分镜框（多边形）
- **TextShape**：文本标注
- **BubbleShape**：对话气泡（带尾巴）
- **DrawingShape**：自由手绘线条
- **ImageShape**：角色占位 + 骨架姿势
- **ArrowShape**：箭头指示

## AI 提示词策略

### 1. 角色表生成
```
输入：参考图像 + 角色名
输出：6姿势角色表（3头像 + 3全身）
关键指令：综合所有参考图特征、统一风格、无文字输出
```

### 2. 分镜布局建议
```
输入：故事脚本 + 角色表 + 当前画布 + 上一页布局
输出：灰度素描分镜布局
关键指令：
- 动态分镜（对角线、重叠、变化尺寸）
- 填满整个画布
- 整合现有用户绘图
- 无文字标注
```

### 3. 漫画页生成
```
输入：
- 角色表（多个）
- 分镜布局（含骨架姿势标注）
- 场景脚本
- 上一页图像（可选）
输出：完整漫画页

关键指令：
- 严格匹配骨架姿势
- 遵循脚本细节（表情、构图）
- 角色数量精确（不多不少）
- 分镜大小反映重要性
- 对话气泡粗黑边框
```

### 4. 质量分析
```
输入：布局指南 + 生成结果 + 脚本 + 角色列表
输出：JSON {analysis, has_discrepancies, correction_prompt}
检查：
- 缺失/错误角色
- 错误姿势
- 布局偏差
- 角色重复
- 背景不当
```

## 用户体验亮点

### 1. 渐进式工作流
```
定义世界观 → 创建角色 → 生成故事 → AI建议布局 → 
手动调整 → 生成漫画 → 分析修正 → 导出
```

### 2. 灵活性强
- 每一步都可以手动干预
- AI建议可接受或忽略
- 支持纯手动绘制分镜
- 支持从任意环节重新生成

### 3. 多语言支持
- 中文/英文/日文界面
- AI 内部使用中文提示词（Gemini对中文友好）

## 创新点总结

### ✅ 角色一致性解决方案
- **角色表系统**：先生成标准参考表，后续生成都基于此表
- **多模态输入**：同时传递文字描述 + 角色图像
- **效果**：Gemini 能较好保持角色外观一致

### ✅ 分镜控制力
- **可视化编辑器**：用户精确控制每个分镜的位置和内容
- **骨架姿势系统**：用骨架定义角色具体姿势
- **效果**：生成结果更符合用户意图

### ✅ AI 辅助而非全自动
- **建议式工作流**：AI 提供建议，用户决定是否采用
- **保留控制权**：每个环节都可手动调整
- **效果**：平衡效率和创作自由

### ✅ 质量保证机制
- **分析 + 自动修正**：AI 检查生成结果并提供修正方案
- **迭代优化**：支持多次编辑和修正
- **效果**：提升最终质量

## 技术优势

1. **纯前端实现**：无需后端服务器，直接调用 Gemini API
2. **轻量依赖**：package.json 极简，构建快速
3. **模块化设计**：组件化清晰，易于维护和扩展
4. **多模态融合**：充分利用 Gemini 的图文混合能力
5. **实时预览**：所有操作即时反馈

## 局限性

1. **依赖 Gemini**：必须有 Gemini API Key
2. **生成速度**：受限于 API 调用速度（尤其是图像生成）
3. **一致性不完美**：虽然有角色表，但仍可能出现偏差
4. **成本**：频繁生成图像可能产生较高 API 费用

## 适用场景

- ✅ 独立创作者快速制作漫画原型
- ✅ 内容工作室批量生产漫画素材
- ✅ 自媒体制作图文故事
- ✅ 教育场景（漫画教学、故事创作）

## 对您的项目启发

### 可借鉴的点
1. **角色表系统**：生成标准参考，后续复用
2. **分镜编辑器**：可视化控制布局
3. **多阶段工作流**：故事 → 布局 → 生成 → 修正
4. **质量检查机制**：AI 自我检查和修正
5. **提示词工程**：详细的分镜指令和约束

### 简化方向（适合3天MVP）
1. **去掉画布编辑器**：直接用 AI 生成全流程
2. **简化角色系统**：预设几个角色模板
3. **自动化分镜**：不需要用户手动布局
4. **四格固定格式**：降低复杂度

## 代码质量
- ✅ TypeScript 类型完整
- ✅ React Hooks 使用规范
- ✅ 状态管理清晰（useState + useCallback）
- ✅ 组件拆分合理
- ✅ 错误处理完善
